<?xml version="1.0"?>
<html t:inherit="module:/templates/layout/layout.xml"
 xmlns:t="http://kauriproject.org/template">
     
  <t:init>
    <t:variable name="personList" src="service:/jpaRestlet/person" accept="application/json"/>
  </t:init>
      
  <t:block name="extra-headers">
    <t:superBlock/>

    <t:include src="service:/jquery/templates/snippet/headerlinks.xml" />

    <script>
      var dataBasePath = "${publicUri('service:/jpaRestlet')}";
      var basePath = "${publicUri('service:/main')}";

      function deletePerson(id) {
          if (!confirm("Do you really want to delete this person?")) {
              return false;
          }

        jQuery.ajax(
            {
                "url": dataBasePath + "/person/" + id + "?method=DELETE",
                type: "POST",
                success: function(data, textStatus) {
                      window.location.reload();
                },
                error: function(xhr, textStatus, errorThrown) {
                  alert("Delete not successful: " + xhr.status + ": " + xhr.statusText);
                }
            });

        return false;
      }
    </script>
  </t:block>

  <t:block name="main">
    <h2>List of persons</h2>

    <table border="1" cellpadding="2" style="text-align: left; width: 75%; background-color: #FFFF99;">
      <tbody>
        <tr style="background-color: #CCCCCC;">
          <th>ID</th>
          <th>Description</th>
          <th width="60px"></th>
          <th width="75px"></th>
        </tr>
        <t:forEach var="pers" in="${personList}">
          <tr>
            <t:attribute name="style" 
              value="${loopStatus.number % 2 == 0 ? 'background-color: #E9EEF4;' : 'background-color: #DFF9DE;'}"/>
            <td>${pers.id}</td>
            <td>${pers.name} ${pers.first} (${pers.persnr})</td>
            <td style="text-align: center;">
              <a href="${publicUri('service:/main/person/')}${pers.id}-edit">edit</a>
            </td>
            <td style="text-align: center;">
              <a href="#" onclick="return deletePerson(${pers.id});">delete</a>
            </td>
          </tr>
        </t:forEach>
      </tbody>
    </table>
    
    <div style="width: 75%; text-align: right;">
      <a href="${publicUri('service:/main/person/new-edit')}">add person</a>
    </div>
    
  </t:block>
</html>