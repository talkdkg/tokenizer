<?xml version="1.0"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:kauri="http://kauriproject.org/runtime/1.0#springext" xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
                             http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
                             http://www.springframework.org/schema/context
                             http://www.springframework.org/schema/context/spring-context-2.5.xsd
                             http://kauriproject.org/runtime/1.0#springext
                             http://www.kauriproject.org/schemas/runtime/springext.xsd"
>
    <context:annotation-config/>
    <bean id="zooKeeper" class="org.lilyproject.util.zookeeper.StateWatchingZooKeeper">
        <constructor-arg>
            <kauri:conf path="zookeeper" select="connectString"/>
        </constructor-arg>
        <constructor-arg>
            <kauri:conf path="zookeeper" select="sessionTimeout"/>
        </constructor-arg>
        <constructor-arg>
            <kauri:conf path="zookeeper" select="startupTimeout"/>
        </constructor-arg>
    </bean>
    <bean id="executorWorker" class="org.tokenizer.executor.worker.ExecutorWorker">
        <constructor-arg ref="executorModel"/>
        <constructor-arg ref="zooKeeper"/>
        <constructor-arg ref="crawlerRepository"/>
    </bean>
    <bean id="executorMaster" class="org.tokenizer.executor.master.ExecutorMaster">
        <constructor-arg ref="executorModel"/>
        <constructor-arg ref="zooKeeper"/>
    </bean>
    <bean id="executorModel" class="org.tokenizer.executor.model.impl.ExecutorModelImpl">
        <constructor-arg ref="zooKeeper"/>
    </bean>
    <bean id="hbaseConfiguration"
        class="org.lilyproject.server.modules.general.HadoopConfigurationFactoryImpl"
        depends-on="zooKeeper"
    >
        <constructor-arg>
            <kauri:conf path="hbase"/>
        </constructor-arg>
        <constructor-arg>
            <kauri:conf path="mapreduce"/>
        </constructor-arg>
        <constructor-arg>
            <kauri:conf path="zookeeper" select="connectString"/>
        </constructor-arg>
        <constructor-arg>
            <kauri:conf path="zookeeper" select="sessionTimeout"/>
        </constructor-arg>
    </bean>
    <bean id="hbaseConf" factory-bean="hbaseConfiguration" factory-method="getHBaseConf"/>
    <bean id="hbaseTableFactory" class="org.lilyproject.util.hbase.HBaseTableFactoryImpl">
        <constructor-arg ref="hbaseConf"/>
    </bean>
    <bean id="crawlerRepository" class="org.tokenizer.crawler.db.CrawlerHBaseRepository">
        <constructor-arg ref="hbaseTableFactory"/>
    </bean>
    <bean id="applicationContextProvider" class="org.tokenizer.core.context.ApplicationContextProvider"></bean>
</beans>